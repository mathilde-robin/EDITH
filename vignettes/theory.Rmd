---
title: "Theory"
output: html_vignette
vignette: >
  %\VignetteIndexEntry{Theory}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<br>

## üéØ **Motivations**

Characterizing interactions between drugs is an area of major interest for drug  
development, as exploiting synergism between drugs could allow increasing  treatment 
efficacy using lower doses of single drugs, and avoiding antagonistic  interaction 
is needed to maintain the therapeutic efficacy of drugs. Broadly speaking,
synergism and antagonism could be defined as an increase or a reduction of the
effect of a drug combination compared to the effect expected for the combination 
on  the basis of the single agent effects.

The `EDITH` package enables the synergistic effects of two or three drugs to be explored,
based on cell viability data obtained from combination experiments. The package 
is designed to analyze and visualize drug interactions and implements a widely 
used method for assessing drug interactions: *the Bliss independence model*.

## üìê **Bliss independence model**

The Bliss independence model is a mathematical framework used to evaluate the independence
(ie. the absence of any interaction effect) of two drugs when they are administered 
in combination. The  general form of Bliss independence model is the following equation:

$$E_{combined} = E_A + E_B - (E_A * E_B)$$
where:

- $E_A$ is the effect of drug A,
- $E_B$ is the effect of drug B,
- $E_{combined}$ is the expected effect of the drug combination.

In the case of a cancer cell population, the effect will correspond to the fraction of
cells killed by the drug(s). For example, if drug A kills 30% of the cells, $E_A = 0.3$ and 
drug B kills 40% of the cells $E_B = 0.4$. According to the Bliss independence model, 
the expected effect of the combination of drugs A and B would be: 
$$E_{combined} = 0.3 + 0.4 - (0.3 * 0.4) = 0.58$$
This means that the combination of drugs A and B is expected to kill 58% of the 
cells if they act independently.

The Bliss equation can be recast in terms of unaffected cells as follows:

$$U_{combined} = U_A * U_B$$

where:

- $U_A$ is the fraction of unaffected cells by drug A (ie. viability after treatment with drug A),
- $U_B$ is the fraction of unaffected cells by drug B (ie. viability after treatment with drug B),
- $U_{combined}$ is the expected fraction of unaffected cells by the drug combination.

For example, if drug A leaves 70% of the cells unaffected, $U_A = 0.7$ and drug B 
leaves 60% of the cells unaffected $U_B = 0.6$. According to the Bliss independence model, 
the expected fraction of unaffected cells by the combination of drugs A and B would be:

$$U_{combined} = 0.7 * 0.6 = 0.42$$
This means that the combination of drugs A and B is expected to leave 42% of the cells 
unaffected if they act independently.

The generalized form of the Bliss equation for a combination of n drugs is:

$$U_{combined} = \prod_{i=1}^n U_i$$

where:

- $i = 1, ..., n$ indexes the drugs in the combination,
- $U_i$ is the fraction of unaffected cells by drug $i$.

## üëÄ Ô∏è**Visual example**

To illustrate the Bliss independence model, consider the following example with two drugs, A and B:

<p align="center">
  <img src="../man/figures/theory_visual.png" alt="theory - visual" width="800">
</p>


## üîç **Evaluation of drug interactions** 

**Interpr√©tation** :
- **Synergie** : Effet observ√© > Effet attendu
- **Additivit√©** : Effet observ√© ‚âà Effet attendu  
- **Antagonisme** : Effet observ√© < Effet attendu

Ensuite, il charge le package `tidyverse` pour la manipulation des donn√©es et la visualisation. Il d√©finit plusieurs fonctions pour effectuer des t√¢ches sp√©cifiques, telles que l'affichage d'un message de bienvenue, le nettoyage des sous-tableaux, la v√©rification des donn√©es, le calcul de la matrice d'additivit√© selon la m√©thode de Bliss, le calcul des indices synth√©tiques selon la m√©thode de Lehar, et la cr√©ation de graphiques de chaleur.
Le script lit un fichier Excel s√©lectionn√© par l'utilisateur, extrait les noms des m√©dicaments et les donn√©es de chaque feuille de calcul, puis effectue les analyses pour chaque bloc de donn√©es (repr√©sentant un r√©plicat). Pour chaque bloc, il nettoie les donn√©es, effectue les v√©rifications n√©cessaires, calcule la matrice d'additivit√© et les indices synth√©tiques, et g√©n√®re des heatmaps pour visualiser les r√©sultats.
Enfin, il enregistre les graphiques dans des fichiers PDF et affiche un message si les doses des m√©dicaments ne sont pas coh√©rentes entre les r√©plicats.
Le script est con√ßu pour √™tre interactif, avec des bo√Ætes de dialogue pour informer l'utilisateur des erreurs ou des avertissements, et pour lui permettre de choisir le fichier Excel √† analyser.
Le script est con√ßu pour √™tre utilis√© dans un environnement R et n√©cessite que l'utilisateur ait les droits d'√©criture dans le r√©pertoire de sortie sp√©cifi√©.

La formule de Bliss est utilis√©e pour √©valuer l'additivit√© des effets de deux ou plusieurs m√©dicaments lorsqu'ils sont administr√©s en combinaison. Elle repose sur l'id√©e que si deux m√©dicaments agissent ind√©pendamment l'un de l'autre, l'effet combin√© devrait √™tre √©gal √† la somme des effets individuels de chaque m√©dicament.
La formule de Bliss est g√©n√©ralement exprim√©e comme suit :

En d'autres termes, si les m√©dicaments A et B sont administr√©s s√©par√©ment, leurs effets individuels sont additionn√©s, mais l'effet combin√© est ajust√© en soustrayant le produit de leurs effets individuels. Cela permet de tenir compte du fait que les m√©dicaments peuvent interagir de mani√®re additive ou synergique.
La formule de Bliss est souvent utilis√©e dans les √©tudes pharmacologiques pour √©valuer si une combinaison de m√©dicaments produit un effet sup√©rieur √† celui attendu en fonction de leurs effets individuels. Si l'effet combin√© est sup√©rieur √† celui pr√©dit par la formule de Bliss, cela sugg√®re une synergie entre les m√©dicaments. Si l'effet combin√© est inf√©rieur, cela indique un antagonisme.

La formule de Lehar est utilis√©e pour √©valuer l'efficacit√© des combinaisons de m√©dicaments en tenant compte de leur interaction. Elle est souvent utilis√©e dans le contexte de la pharmacologie pour quantifier l'effet d'une combinaison de m√©dicaments par rapport √† leurs effets individuels.
La formule de Lehar est g√©n√©ralement exprim√©e comme suit :
CI = (E_A * E_B) / E_combined
o√π :
- CI est l'indice de combinaison, qui quantifie l'interaction entre les m√©dicaments.
- E_A est l'effet du m√©dicament A.
- E_B est l'effet du m√©dicament B.
- E_combined est l'effet combin√© des deux m√©dicaments lorsqu'ils sont administr√©s ensemble.
L'indice de combinaison (CI) est utilis√© pour √©valuer si l'effet combin√© des m√©dicaments est sup√©rieur, inf√©rieur ou √©gal √† la somme de leurs effets individuels. Un CI sup√©rieur √† 1 indique une synergie entre les m√©dicaments, c'est-√†-dire que leur effet combin√© est sup√©rieur √† ce qui serait attendu en additionnant leurs effets individuels. Un CI √©gal √† 1 indique une additivit√©, tandis qu'un CI inf√©rieur √† 1 sugg√®re un antagonisme, o√π l'effet combin√© est inf√©rieur √† la somme des effets individuels.
La formule de Lehar est souvent utilis√©e dans les √©tudes pharmacologiques pour √©valuer l'efficacit√© des combinaisons de m√©dicaments, en particulier dans le contexte du traitement du cancer ou d'autres maladies o√π plusieurs m√©dicaments sont utilis√©s simultan√©ment. Elle permet aux chercheurs de mieux comprendre comment les m√©dicaments interagissent entre eux et d'optimiser les sch√©mas th√©rapeutiques.

-----

**Method**:

*Index*:

According to the approach proposed by Lehar (Leh√°r et al., 2007, 2008, 2009), a point-by-point calculation of the expected values in case of absence of interaction effect is performed over all the matrix concentration combinations in order to obtain an expected-value matrix. Then, a **combination index**, **CI**, is calculated as follows: $CI = \ln f_A \ln f_B \sum_{A,B} (M_0 - M_E)$ where $M_O$ and $M_E$ are the matrices of the observed and expected values, respectively, and $f_A$ and $f_B$ are the dilution factors for the drugs A and B. The **CI** is a positive-gated, effect-weighted volume over the lack of interaction effect (i.e. Bliss independence), adjusted for variable dilution factors $f_A$ and $f_B$. An **efficacy index** is also calculated as follow: $EI = \ln f_A \ln f_B \sum_{A,B} M_0$. 

Leh√°r, J., Zimmermann, G.R., Krueger, A.S., Molnar, R.A., Ledell, J.T., Heilbut, A.M., Short, G.F., Giusti, L.C., Nolan, G.P., Magid, O.A., et al. (2007). Chemical combination effects predict connectivity in biological systems. Mol. Syst. Biol. 3, 80.

Leh√°r, J., Stockwell, B.R., Giaever, G., and Nislow, C. (2008). Combination chemical genetics. Nat. Chem. Biol. 4, 674‚Äì681.

Leh√°r, J., Krueger, A.S., Avery, W., Heilbut, A.M., Johansen, L.M., Price, E.R., Rickles, R.J., Short, G.F., Staunton, J.E., Jin, X., et al. (2009). Synergistic drug combinations tend to improve therapeutically relevant selectivity. Nat. Biotechnol. 27, 659‚Äì666.

Note: $M_O$ et $M_E$ correspondent aux nombres de cellules mortes (et pas vivantes comme dans nos calculs ...)
